import{_ as s,c as n,o as a,a as l}from"./app.82736834.js";const b=JSON.parse('{"title":"HDFS HA - HDFS高可用","description":"","frontmatter":{},"headers":[{"level":2,"title":"搭建准备","slug":"搭建准备","link":"#搭建准备","children":[]},{"level":2,"title":"配置环境变量","slug":"配置环境变量","link":"#配置环境变量","children":[]},{"level":2,"title":"配置 zookeeper","slug":"配置-zookeeper","link":"#配置-zookeeper","children":[]},{"level":2,"title":"配置集群","slug":"配置集群","link":"#配置集群","children":[]},{"level":2,"title":"集群初始化","slug":"集群初始化","link":"#集群初始化","children":[{"level":3,"title":"1.启动 Zookeeper","slug":"_1-启动-zookeeper","link":"#_1-启动-zookeeper","children":[]},{"level":3,"title":"2.启动 JournalNode","slug":"_2-启动-journalnode","link":"#_2-启动-journalnode","children":[]},{"level":3,"title":"3.初始化 NN1/NN2","slug":"_3-初始化-nn1-nn2","link":"#_3-初始化-nn1-nn2","children":[]},{"level":3,"title":"4.Zookeeper 中初始化集群","slug":"_4-zookeeper-中初始化集群","link":"#_4-zookeeper-中初始化集群","children":[]}]},{"level":2,"title":"测试集群","slug":"测试集群","link":"#测试集群","children":[{"level":3,"title":"在 node01 启动 HDFS","slug":"在-node01-启动-hdfs","link":"#在-node01-启动-hdfs","children":[]},{"level":3,"title":"查看集群启动情况","slug":"查看集群启动情况","link":"#查看集群启动情况","children":[]},{"level":3,"title":"查看 Zookeeper","slug":"查看-zookeeper","link":"#查看-zookeeper","children":[]},{"level":3,"title":"在浏览器中查看集群","slug":"在浏览器中查看集群","link":"#在浏览器中查看集群","children":[]},{"level":3,"title":"测试故障自动切换","slug":"测试故障自动切换","link":"#测试故障自动切换","children":[]}]},{"level":2,"title":"集群的启动与关闭","slug":"集群的启动与关闭","link":"#集群的启动与关闭","children":[]},{"level":2,"title":"拍摄快照","slug":"拍摄快照","link":"#拍摄快照","children":[]}],"relativePath":"linux/hadoop/4hdfs-ha.md","lastUpdated":1666573583000}'),e={name:"linux/hadoop/4hdfs-ha.md"},p=l(`<h1 id="hdfs-ha-hdfs高可用" tabindex="-1">HDFS HA - HDFS高可用 <a class="header-anchor" href="#hdfs-ha-hdfs高可用" aria-hidden="true">#</a></h1><blockquote><p>上面我们搭建的完全分布式环境是属于Hadoop1.x的，这个版本的完全分布式存在 高可用(High Availability) 、扩展性 方面的问题。</p></blockquote><h2 id="搭建准备" tabindex="-1">搭建准备 <a class="header-anchor" href="#搭建准备" aria-hidden="true">#</a></h2><p>先创建目录，包括 ha、dir-shared、zk 三个目录，由于是被不同集群角色使用，不同节点上创建的目录不一样。</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 指定 hadoop HA 临时目录(node01、node02、node03、node04)</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/ha</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 指定 JournalNode 在本地磁盘存放数据的位置(node01、node02、node03)</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/ha/dir-shared</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 配置 zookeeper 的临时目录(node02、node03、node04)</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/zk</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="配置环境变量" tabindex="-1">配置环境变量 <a class="header-anchor" href="#配置环境变量" aria-hidden="true">#</a></h2><p>在 node02 打开配置文件:</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">~/.bash_profile</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># JAVA_HOME jdk目录</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#EEFFFF;"> JAVA_HOME</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/home/hadoop/jdk1.8.0_281</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># HADOOP_HOME hadoop目录</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#EEFFFF;"> HADOOP_HOME</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/home/hadoop/hadoop-3.1.4</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># ZOOKEEPER_HOME zookeeper目录</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#EEFFFF;"> ZOOKEEPER_HOME</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/home/hadoop/zookeeper-3.4.14</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 指定classpath</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#EEFFFF;"> CLASSPATH</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">.:</span><span style="color:#EEFFFF;">$JAVA_HOME</span><span style="color:#C3E88D;">/lib/tools.jar:</span><span style="color:#EEFFFF;">$JAVA_HOME</span><span style="color:#C3E88D;">/lib/dt.jar:</span><span style="color:#EEFFFF;">$JAVA_HOME</span><span style="color:#C3E88D;">/lib</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 把jdk、hadoop、zk的bin和hadoop的sbin目录加入到环境变量</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#EEFFFF;"> PATH</span><span style="color:#89DDFF;">=</span><span style="color:#EEFFFF;">$PATH</span><span style="color:#C3E88D;">:</span><span style="color:#EEFFFF;">$JAVA_HOME</span><span style="color:#C3E88D;">/bin:</span><span style="color:#EEFFFF;">$HADOOP_HOME</span><span style="color:#C3E88D;">/bin:</span><span style="color:#EEFFFF;">$HADOOP_HOME</span><span style="color:#C3E88D;">/sbin:</span><span style="color:#EEFFFF;">$ZOOKEEPER_HOME</span><span style="color:#C3E88D;">/bin</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>向 node03、node04 进行环境变量文件的分发</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 向node03进行分发</span></span>
<span class="line"><span style="color:#FFCB6B;">scp</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">~/.bash_profile</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">node03:/home/hadoop/</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 向node04进行分发</span></span>
<span class="line"><span style="color:#FFCB6B;">scp</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">~/.bash_profile</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">node04:/home/hadoop/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>分发完成后，记得在三台虚拟机中分别使用 source .bash_profile 使环境变量配置文件生效</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">source</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">~/.bash_profile</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="配置-zookeeper" tabindex="-1">配置 zookeeper <a class="header-anchor" href="#配置-zookeeper" aria-hidden="true">#</a></h2><p>根据集群的角色的分配，需要在 node02、node03、node04 上面配置 zookeeper</p><div class="tip custom-block"><p class="custom-block-title">配置 zookeeper 的步骤</p><p>先在 node02 上面配置好 zookeeper 然后再使用 scp 分发到 node03、 node04 上面</p></div><ul><li><h3 id="下载-zookeeper" tabindex="-1">下载 zookeeper <a class="header-anchor" href="#下载-zookeeper" aria-hidden="true">#</a></h3></li></ul><p>123网盘：</p><blockquote><p><a href="https://www.123pan.com/s/zCYKVv-CJXR" target="_blank" rel="noreferrer">zookeeper-3.4.14</a>（推荐）</p></blockquote><p>阿里云镜像：</p><blockquote><p><a href="https://mirrors.aliyun.com/apache/zookeeper/zookeeper-3.8.0/apache-zookeeper-3.8.0.tar.gz" target="_blank" rel="noreferrer">https://mirrors.aliyun.com/apache/zookeeper/zookeeper-3.8.0/apache-zookeeper-3.8.0.tar.gz</a></p></blockquote><ul><li><h3 id="将-zookeeper-压缩包传到-node02-然后解压" tabindex="-1">将 zookeeper 压缩包传到 node02 然后解压 <a class="header-anchor" href="#将-zookeeper-压缩包传到-node02-然后解压" aria-hidden="true">#</a></h3></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 解压zookeeper</span></span>
<span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-xvf</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zookeeper-3.4.14.tar.gz</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><h3 id="在-node02-进入-zookeeper-的配置文件目录" tabindex="-1">在 node02 进入 zookeeper 的配置文件目录 <a class="header-anchor" href="#在-node02-进入-zookeeper-的配置文件目录" aria-hidden="true">#</a></h3></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 进入目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/zookeeper-3.4.14/conf</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 查看目录结构</span></span>
<span class="line"><span style="color:#FFCB6B;">ll</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha1.jpg" alt="ha1"></p><ul><li><h3 id="把-zoo-sample-cfg-改名为-zoo-cfg" tabindex="-1"><strong>把 zoo_sample.cfg 改名为 zoo.cfg</strong> <a class="header-anchor" href="#把-zoo-sample-cfg-改名为-zoo-cfg" aria-hidden="true">#</a></h3></li></ul><blockquote><p>zoo.cfg 是 zookeeper 的配置文件</p></blockquote><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 复制 zoo_sample.cfg 改名为 zoo.cfg</span></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zoo_sample.cfg</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zoo.cfg</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><h3 id="编辑-zoo-cfg-添加如下配置" tabindex="-1"><strong>编辑 zoo.cfg ，添加如下配置</strong> <a class="header-anchor" href="#编辑-zoo-cfg-添加如下配置" aria-hidden="true">#</a></h3></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 配置zookeeper的临时目录</span></span>
<span class="line"><span style="color:#EEFFFF;">dataDir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/zk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 配置zookeeper集群服务器编号，以及对应的主机名、通信端口(心跳检测端口)、选举端口号。</span></span>
<span class="line"><span style="color:#FFCB6B;">server.1=node02:2888:3888</span></span>
<span class="line"><span style="color:#FFCB6B;">server.2=node03:2888:3888</span></span>
<span class="line"><span style="color:#FFCB6B;">server.3=node04:2888:3888</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><h3 id="在-node02-上向-node03、node04-分发已经配置好的-zookeeper" tabindex="-1"><strong>在 node02 上向 node03、node04 分发已经配置好的 zookeeper</strong> <a class="header-anchor" href="#在-node02-上向-node03、node04-分发已经配置好的-zookeeper" aria-hidden="true">#</a></h3></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 向node03分发</span></span>
<span class="line"><span style="color:#FFCB6B;">scp</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/zookeeper-3.4.14</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">node03:/home/hadoop/</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 向node04分发</span></span>
<span class="line"><span style="color:#FFCB6B;">scp</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/zookeeper-3.4.14</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">node04:/home/hadoop/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><h3 id="在-zookeeper-的-datadir-目录下创建一个-myid-文件" tabindex="-1"><strong>在 zookeeper 的 dataDir 目录下创建一个 myid 文件</strong> <a class="header-anchor" href="#在-zookeeper-的-datadir-目录下创建一个-myid-文件" aria-hidden="true">#</a></h3></li></ul><p>node02:</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 在node02机器上，创建目录</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/zk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 进入目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/zk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 把“1”写入myid</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">myid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 查看“1”有没有写入成功</span></span>
<span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">myid</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>node03:</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 在node03机器上，创建目录</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/zk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 进入目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/zk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 把“2”写入myid</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">2</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">myid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 查看“2”有没有写入成功</span></span>
<span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">myid</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>node04:</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 在node04机器上，创建目录</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/zk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 进入目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-data/zk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 把“3”写入myid</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">3</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">myid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 查看“3”有没有写入成功</span></span>
<span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">myid</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="配置集群" tabindex="-1">配置集群 <a class="header-anchor" href="#配置集群" aria-hidden="true">#</a></h2><ul><li><h3 id="在-node01-上配置hadoop-env-sh文件" tabindex="-1">在 node01 上配置hadoop-env.sh文件 <a class="header-anchor" href="#在-node01-上配置hadoop-env-sh文件" aria-hidden="true">#</a></h3></li></ul><div class="tip custom-block"><p class="custom-block-title">可选择</p><p>如果在1.0完全分布式的基础上配置，此步骤可省略</p></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-3.1.4/etc/hadoop/hadoop-env.sh</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 第54行 配置JAVA_HOME</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#EEFFFF;"> JAVA_HOME</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/home/hadoop/jdk1.8.0_281</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 第58行 配置HADOOP_HOME</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#EEFFFF;"> HADOOP_HOME</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/home/hadoop/hadoop-3.1.4</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha2.jpg" alt="ha2"></p><ul><li><h3 id="配置-core-site-xml" tabindex="-1">配置 core-site.xml <a class="header-anchor" href="#配置-core-site-xml" aria-hidden="true">#</a></h3></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-3.1.4/etc/hadoop/core-site.xml</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#EEFFFF;">xml version</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> encoding</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">?&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#EEFFFF;">xml-stylesheet type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text/xsl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">configuration.xsl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">?&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#EEFFFF;">configuration</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">	</span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">指定hdfs的nameservice为mycluster</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">  	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;fs.defaultFS&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;hdfs://mycluster&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">	</span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">指定hadoop临时目录</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">		</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;hadoop.tmp.dir&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">		</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;/home/hadoop/hadoop-data/ha&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">	</span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">指定zookeeper集群地址</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">  	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;ha.zookeeper.quorum&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;node02:2181,node03:2181,node04:2181&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#EEFFFF;">/configuration</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li><h3 id="配置-hdfs-site-xml" tabindex="-1">配置 hdfs-site.xml <a class="header-anchor" href="#配置-hdfs-site-xml" aria-hidden="true">#</a></h3></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-3.1.4/etc/hadoop/hdfs-site.xml</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#EEFFFF;">xml version</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> encoding</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">?&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#EEFFFF;">xml-stylesheet type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text/xsl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">configuration.xsl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">?&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#EEFFFF;">configuration</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">配置副本数为3</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.replication&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;3&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">指定hdfs的nameservice为mycluster，需要和core-site.xml中的“fs.defaultFS”保持⼀致</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.nameservices&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;mycluster&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">mycluster下面有两个NameNode，分别是nn1，nn2</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.ha.namenodes.mycluster&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;nn1,nn2&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">nn1的RPC通信地址</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.namenode.rpc-address.mycluster.nn1&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;node01:8020&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">nn2的RPC通信地址</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.namenode.rpc-address.mycluster.nn2&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;node02:8020&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">nn1的http通信地址</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.namenode.http-address.mycluster.nn1&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;node01:9870&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">nn2的http通信地址</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.namenode.http-address.mycluster.nn2&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;node02:9870&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">指定活跃NameNode的元数据在JournalNode上的存放位置</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;qjournal://node01:8485</span><span style="color:#89DDFF;">;</span><span style="color:#FFCB6B;">node02:8485</span><span style="color:#89DDFF;">;</span><span style="color:#FFCB6B;">node03:8485/mycluster&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">指定JournalNode在本地磁盘存放数据的位置</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.journalnode.edits.dir&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">此目录一定要创建</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;/home/hadoop/hadoop-data/ha/dir-shared&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">nn对jn检测的重试次数，默认为10次，每次1000ms，故网络情况差需要增加，这里设置为30次</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">         </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;ipc.client.connect.max.retries&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">         </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;30&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">下面的配置都是关于故障转移</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">开启NameNode失败自动切换</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">true</span><span style="color:#C3E88D;">：表示自动切换；</span><span style="color:#89DDFF;">false</span><span style="color:#C3E88D;">：手动切换</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;</span><span style="color:#82AAFF;">true</span><span style="color:#FFCB6B;">&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">被DFS客户端用来确定哪个NameNode是当前活跃的NameNode</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.client.failover.proxy.provider.mycluster&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">下面配置的是隔离机制</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">配置“状态隔离”机制方法，就是主NameNode发生故障以后要进行隔离，防止“脑裂”</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">配置的时候，一行一个</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.ha.fencing.methods&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">          </span><span style="color:#FFCB6B;">sshfence</span></span>
<span class="line"><span style="color:#EEFFFF;">          </span><span style="color:#FFCB6B;">shell(/bin/</span><span style="color:#82AAFF;">true</span><span style="color:#EEFFFF;">)</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">使sshfence隔离机制时需要ssh免登陆</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">注意此密钥文件，根据自己的实际路径，与实际名称来配置</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;/home/hadoop/.ssh/id_dsa&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;!</span><span style="color:#FFCB6B;">--</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">配置sshfence隔离机制超时时间</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">property&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">name&gt;dfs.ha.fencing.ssh.connect-timeout&lt;/name&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">value&gt;30000&lt;/value&gt;</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">/property&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#EEFFFF;">/configuration</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><ul><li><h3 id="配置workers文件-3版本以前叫slavers-里面配置的是datanode信息" tabindex="-1">配置workers文件(3版本以前叫slavers)，里面配置的是DataNode信息 <a class="header-anchor" href="#配置workers文件-3版本以前叫slavers-里面配置的是datanode信息" aria-hidden="true">#</a></h3></li></ul><div class="tip custom-block"><p class="custom-block-title">可选择</p><p>如果在1.0完全分布式的基础上配置，此步骤可省略</p></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-3.1.4/etc/hadoop/workers</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>设置如下信息</strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">node02</span></span>
<span class="line"><span style="color:#FFCB6B;">node03</span></span>
<span class="line"><span style="color:#FFCB6B;">node04</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>到这一步完成了Hadoop的配置</p><ul><li><h3 id="分发hadoop配置文件" tabindex="-1">分发Hadoop配置文件 <a class="header-anchor" href="#分发hadoop配置文件" aria-hidden="true">#</a></h3></li></ul><p>在node01上使用scp命令对hadoop目录往node02、node03、node04完成分发。</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 对node02进行分发</span></span>
<span class="line"><span style="color:#FFCB6B;">scp</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-3.1.4</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">node02:/home/hadoop/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 对node03进行分发</span></span>
<span class="line"><span style="color:#FFCB6B;">scp</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-3.1.4</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">node03:/home/hadoop/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 对node04进行分发</span></span>
<span class="line"><span style="color:#FFCB6B;">scp</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/hadoop-3.1.4</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">node04:/home/hadoop/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="集群初始化" tabindex="-1">集群初始化 <a class="header-anchor" href="#集群初始化" aria-hidden="true">#</a></h2><p>配置了HA高可用的集群的初始化，跟以前的集群初始化有本质上的区别，会牵涉到很多个步骤</p><h3 id="_1-启动-zookeeper" tabindex="-1">1.启动 Zookeeper <a class="header-anchor" href="#_1-启动-zookeeper" aria-hidden="true">#</a></h3><p>Zookeeper不像Hadoop，只需要在NameNode上启动，其他其它也会启动，所以需要在每台服务器上$ZOOKEEPER_HOME/bin目录下执行 “<a href="http://zkServer.sh" target="_blank" rel="noreferrer">zkServer.sh</a>” 文件</p><ul><li><strong>我们到 node02、node03、node04 启动 Zookeeper</strong></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 启动zookeeper</span></span>
<span class="line"><span style="color:#FFCB6B;">zkServer.sh</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">start</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><strong>查看 Zookeeper 启动状态</strong></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">zkServer.sh</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">status</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>node02 运行的可能情况</strong></p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha3.jpg" alt="ha3"></p><p><strong>node03 运行的可能情况</strong></p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha4.jpg" alt="ha4"></p><p><strong>node04 运行的可能情况</strong></p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha5.jpg" alt="ha5"></p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>我们搭建的 Zookeeper 集群是3台，分别是 node02、node03、node04 ，这三台中满足“一主二从”，并且三台机器都有“QuorumPeerMain”后台进程。这三台 Zookeeper 哪台是 leader 哪两台是 follower 有很大的随机性。</p></div><h3 id="_2-启动-journalnode" tabindex="-1">2.启动 JournalNode <a class="header-anchor" href="#_2-启动-journalnode" aria-hidden="true">#</a></h3><ul><li><strong>到 node01、node02、node03 启动 JournalNode 进程</strong></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 启动命令</span></span>
<span class="line"><span style="color:#FFCB6B;">hadoop-daemon.sh</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">start</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">journalnode</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha6.jpg" alt="ha6"></p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha7.jpg" alt="ha7"></p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha8.jpg" alt="ha8"></p><h3 id="_3-初始化-nn1-nn2" tabindex="-1">3.初始化 NN1/NN2 <a class="header-anchor" href="#_3-初始化-nn1-nn2" aria-hidden="true">#</a></h3><ul><li><strong>在 node01 上格式化</strong></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">hdfs</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">namenode</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-format</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><strong>在 node01 节点上启动 namenode 节点</strong></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">hadoop-daemon.sh</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">start</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">namenode</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><strong>在 node02 节点上拷贝 node01 的元数据信息</strong></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">hdfs</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">namenode</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-bootstrapStandby</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>运行结果:</p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha9.jpg" alt="ha9"></p><h3 id="_4-zookeeper-中初始化集群" tabindex="-1">4.Zookeeper 中初始化集群 <a class="header-anchor" href="#_4-zookeeper-中初始化集群" aria-hidden="true">#</a></h3><p><strong>zk 安装在 node02、node03、node04 上面，我们任意登录一台，比如登录 node02，先进入下面的目录</strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 进入bin目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/home/hadoop/zookeeper-3.4.14/bin</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha10.jpg" alt="ha10"></p><ul><li><strong>运行 Zookeeper 客户端</strong></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 运行zk客户端</span></span>
<span class="line"><span style="color:#FFCB6B;">zkCli.sh</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 查看zookeeper的根目录</span></span>
<span class="line"><span style="color:#FFCB6B;">ls</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>运行情况:</p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha11.jpg" alt="ha11"></p><ul><li><strong>在 Zookeeper 中初始化HA</strong></li></ul><div class="warning custom-block"><p class="custom-block-title">注意</p><p>此步骤必须在namenode上，也就是node01</p></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 在node01上运行</span></span>
<span class="line"><span style="color:#FFCB6B;">hdfs</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zkfc</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-formatZK</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha12.jpg" alt="ha12"></p><ul><li><strong>到 node02 (zookeeper 客户端) 里面查看初始化的 HA</strong></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">ls</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/</span></span>
<span class="line"><span style="color:#FFCB6B;">ls</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/hadoop-ha</span></span>
<span class="line"><span style="color:#FFCB6B;">ls</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/hadoop-ha/mycluster</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>运行结果:</p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha13.jpg" alt="ha13"></p><ul><li><strong>node02 退出 zk 客户端</strong></li></ul><blockquote><p>control + c</p></blockquote><div class="tip custom-block"><p class="custom-block-title">配置完成</p><p>到这一步基本完成配置，下面进行测试</p></div><h2 id="测试集群" tabindex="-1">测试集群 <a class="header-anchor" href="#测试集群" aria-hidden="true">#</a></h2><h3 id="在-node01-启动-hdfs" tabindex="-1">在 node01 启动 HDFS <a class="header-anchor" href="#在-node01-启动-hdfs" aria-hidden="true">#</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 由于zookeeper已经启动，只需要在node01启动HDFS即可</span></span>
<span class="line"><span style="color:#FFCB6B;">start-dfs.sh</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha14.jpg" alt="ha14"></p><h3 id="查看集群启动情况" tabindex="-1">查看集群启动情况 <a class="header-anchor" href="#查看集群启动情况" aria-hidden="true">#</a></h3><p>node01运行情况:</p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha15.jpg" alt="ha15" style="zoom:82%;"><p>node02运行情况:</p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha16.jpg" alt="ha16" style="zoom:80%;"><p>node03运行情况:</p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha17.jpg" alt="ha17" style="zoom:92%;"><p>node04运行情况:</p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha18.jpg" alt="ha18" style="zoom:94%;"><p>集群后台进程情况汇总:</p><table><thead><tr><th style="text-align:center;">node01</th><th style="text-align:center;">node02</th><th style="text-align:center;">node03</th><th style="text-align:center;">node04</th></tr></thead><tbody><tr><td style="text-align:center;">DFSZKFailoverController<br>JournalNode<br>NameNode</td><td style="text-align:center;">DataNode<br>NameNode<br>QuorumPeerMain<br>JournalNode<br>DFSZKFailoverController</td><td style="text-align:center;">QuorumPeerMain<br>JournalNode<br>DataNode</td><td style="text-align:center;">QuorumPeerMain<br>DataNode</td></tr></tbody></table><p><strong>说明:</strong></p><p><strong>NameNode：名称节点进程</strong></p><p><strong>DataNode：数据节点进程</strong></p><p><strong>DFSZKFailoverController：ZKFC进程</strong></p><p><strong>JournalNode：JNN进程</strong></p><p><strong>QuorumPeerMain：zookeeper集群进程</strong></p><h3 id="查看-zookeeper" tabindex="-1">查看 Zookeeper <a class="header-anchor" href="#查看-zookeeper" aria-hidden="true">#</a></h3><p><strong>通过查看zookeeper里面注册信息会发现，里面多了两个节点，分别是 ActiveBreadCrumb, ActiveStandbyElectorLock</strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 在node02上运行zk客户端</span></span>
<span class="line"><span style="color:#FFCB6B;">zkCli.sh</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># 在zookeeper客户端里面运行</span></span>
<span class="line"><span style="color:#FFCB6B;">ls</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/hadoop-ha/mycluster</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>运行结果:</p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha19.jpg" alt="ha19"></p><p><strong>查看 ActiveBreadCrumb 内容:</strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">get</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/hadoop-ha/mycluster/ActiveBreadCrumb</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>运行结果:</p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha20.jpg" alt="ha20"></p><p>通过查明 ActiveBreadCrumb 发现注册的活跃主节点是 node01</p><h3 id="在浏览器中查看集群" tabindex="-1">在浏览器中查看集群 <a class="header-anchor" href="#在浏览器中查看集群" aria-hidden="true">#</a></h3><ul><li><strong>通过下面命令查看端口信息</strong></li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 此处 192.168.60.101 为对应虚拟机 ip 地址</span></span>
<span class="line"><span style="color:#FFCB6B;">ss</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-nal</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">|</span><span style="color:#EEFFFF;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">192.168.60.101</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>运行效果:</p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha21.jpg" alt="ha21"></p><p><strong>node01为nn1</strong>：<a href="http://node01:9870/dfshealth.html" target="_blank" rel="noreferrer">http://node01:9870/dfshealth.html</a></p><p><strong>node02为nn2</strong>：<a href="http://node02:9870/dfshealth.html" target="_blank" rel="noreferrer">http://node02:9870/dfshealth.html</a></p><p><strong>HDFS</strong>：<a href="http://node01:9870/explorer.html" target="_blank" rel="noreferrer">http://node01:9870/explorer.html</a></p><p><strong>node01显示“active”</strong></p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha22.jpg" alt="ha22"></p><p><strong>node02显示“standby”</strong></p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha23.jpg" alt="ha23"></p><h3 id="测试故障自动切换" tabindex="-1">测试故障自动切换 <a class="header-anchor" href="#测试故障自动切换" aria-hidden="true">#</a></h3><p>我们搭建HA高可用，就是为了解决单点故障，现在我们来测试一下，我们可以关闭node01的 namenode进程，然后再启动namenode进程，来模拟主节点故障，然后查看集群的情况，是否实现了活跃主节点的切换。</p><p><strong>在 node01 上 关闭 namenode 进程，观察 <a href="http://node02:9870/dfshealth.html" target="_blank" rel="noreferrer">node02</a></strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 先关闭namenode</span></span>
<span class="line"><span style="color:#FFCB6B;">hadoop-daemon.sh</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">namenode</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha24.jpg" alt="ha24"><br><strong>在 node01 上 启动 namenode 进程，观察 <a href="http://node01:9870/dfshealth.html" target="_blank" rel="noreferrer">node01</a></strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#545454;font-style:italic;"># 再启动namenode</span></span>
<span class="line"><span style="color:#FFCB6B;">hadoop-daemon.sh</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">start</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">namenode</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha25.jpg" alt="ha25"></p><h2 id="集群的启动与关闭" tabindex="-1">集群的启动与关闭 <a class="header-anchor" href="#集群的启动与关闭" aria-hidden="true">#</a></h2><ul><li><p><strong>集群启动：先启动 zookeeper，然后再启动 hdfs</strong></p><ul><li>分别在 node02、node03、node04 启动zookeeper</li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">zkServer.sh</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">start</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>在 node01 启动HDFS</li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">start-dfs.sh</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ul><p>运行结果:</p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha26.jpg" alt="ha26"></p><p>通过 <a href="http://start-dfs.sh" target="_blank" rel="noreferrer">start-dfs.sh</a> 启动集群的时候，启动顺序是：</p><p>先启动 namenode，然后启动 datanode，再启动 JNN，最后启动 ZKFC</p><hr><ul><li><p><strong>集群关闭：先关hdfs，再关zookeeper</strong></p><ul><li>在 node01 关闭HDFS</li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">stop-dfs.sh</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>分别在 node02、node03、node04 关闭 zookeeper</li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">zkServer.sh</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">stop</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ul><p>运行结果:</p><p><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha27.jpg" alt="ha27"></p><p>通过 <a href="http://stop-dfs.sh" target="_blank" rel="noreferrer">stop-dfs.sh</a> 关闭的时候，关闭的顺序是：</p><p>先关闭 namenode，然后关闭 datanode，然后关闭 JNN，然后关闭 ZKFC</p><h2 id="拍摄快照" tabindex="-1">拍摄快照 <a class="header-anchor" href="#拍摄快照" aria-hidden="true">#</a></h2><ul><li>关闭集群、关闭虚拟机后 分别对四台虚拟机拍摄快照</li></ul><img src="https://notewk-1304925042.cos.ap-guangzhou.myqcloud.com/notewk/ha28.jpg" alt="ha28" style="zoom:50%;"><div class="tip custom-block"><p class="custom-block-title">配置完成</p><p>HDFS HA 配置成功 🎉 💯 🏆</p></div>`,176),o=[p];function r(t,c,F,i,d,y){return a(),n("div",null,o)}const h=s(e,[["render",r]]);export{b as __pageData,h as default};
