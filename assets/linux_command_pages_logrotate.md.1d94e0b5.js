import{_ as s,c as n,o as a,a as l}from"./app.82736834.js";const u=JSON.parse('{"title":"logrotate","description":"","frontmatter":{},"headers":[{"level":2,"title":"补充说明","slug":"补充说明","link":"#补充说明","children":[{"level":3,"title":"语法","slug":"语法","link":"#语法","children":[]},{"level":3,"title":"选项","slug":"选项","link":"#选项","children":[]},{"level":3,"title":"参数","slug":"参数","link":"#参数","children":[]},{"level":3,"title":"实例","slug":"实例","link":"#实例","children":[]},{"level":3,"title":"注意事项","slug":"注意事项","link":"#注意事项","children":[]}]}],"relativePath":"linux/command/pages/logrotate.md","lastUpdated":1666509709000}'),e={name:"linux/command/pages/logrotate.md"},p=l(`<h1 id="logrotate" tabindex="-1">logrotate <a class="header-anchor" href="#logrotate" aria-hidden="true">#</a></h1><p>系统日志进行轮转、压缩和删除</p><h2 id="补充说明" tabindex="-1">补充说明 <a class="header-anchor" href="#补充说明" aria-hidden="true">#</a></h2><p><strong>logrotate命令</strong> 用于对系统日志进行轮转、压缩和删除，也可以将日志发送到指定邮箱。使用logrotate指令，可让你轻松管理系统所产生的记录文件。每个记录文件都可被设置成每日，每周或每月处理，也能在文件太大时立即处理。您必须自行编辑，指定配置文件，预设的配置文件存放在<code>/etc/logrotate.conf</code>文件中。</p><h3 id="语法" tabindex="-1">语法 <a class="header-anchor" href="#语法" aria-hidden="true">#</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">logrotate(选项</span><span style="color:#EEFFFF;">)</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">参数</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="选项" tabindex="-1">选项 <a class="header-anchor" href="#选项" aria-hidden="true">#</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">-?或--help：在线帮助；</span></span>
<span class="line"><span style="color:#FFCB6B;">-d或--debug：详细显示指令执行过程，便于排错或了解程序执行的情况；</span></span>
<span class="line"><span style="color:#FFCB6B;">-f或--force</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">：强行启动记录文件维护操作，纵使logrotate指令认为没有需要亦然；</span></span>
<span class="line"><span style="color:#FFCB6B;">-s&lt;状态文件&gt;或--state=&lt;状态文件&gt;：使用指定的状态文件；</span></span>
<span class="line"><span style="color:#FFCB6B;">-v或--version：显示指令执行过程；</span></span>
<span class="line"><span style="color:#FFCB6B;">-usage：显示指令基本用法。</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="参数" tabindex="-1">参数 <a class="header-anchor" href="#参数" aria-hidden="true">#</a></h3><p>配置文件：指定lograote指令的配置文件。</p><h3 id="实例" tabindex="-1">实例 <a class="header-anchor" href="#实例" aria-hidden="true">#</a></h3><p>crontab 会定时调用logrotate命令 在 <code>/etc/cron.daily/logrotate</code> 文件中配置使用</p><p>logrotate的配置文件<code>/etc/logrotate.conf</code> 定义引用<code>/etc/logrotate.d</code>目录下的一些自定义的log配置</p><p>在<code>/etc/logrotate.d</code>目录下创建任意后缀名的文件,即可使用对日志进行轮转</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">/tmp/log/log.txt</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">copytruncate</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">daily</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">rotate</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">30</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">missingok</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">ifempty</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">compress</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">noolddir</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这个配置文件代表的意思是将<code>/tmp/log/log.txt</code>文件 进行轮转压缩</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#EEFFFF;">compress                 通过gzip 压缩转储以后的日志</span></span>
<span class="line"><span style="color:#EEFFFF;">nocompress               不做gzip压缩处理</span></span>
<span class="line"><span style="color:#EEFFFF;">copytruncate             用于还在打开中的日志文件，把当前日志备份并截断；是先拷贝再清空的方式，拷贝和清空之间有一个时间差，可能会丢失部分日志数据。</span></span>
<span class="line"><span style="color:#EEFFFF;">nocopytruncate 备份日志文件不过不截断</span></span>
<span class="line"><span style="color:#EEFFFF;">create mode owner group  轮转时指定创建新文件的属性，如create 0777 nobody nobody</span></span>
<span class="line"><span style="color:#EEFFFF;">nocreate                 不建立新的日志文件</span></span>
<span class="line"><span style="color:#EEFFFF;">delaycompress            和compress 一起使用时，转储的日志文件到下一次转储时才压缩</span></span>
<span class="line"><span style="color:#EEFFFF;">nodelaycompress          覆盖 delaycompress 选项，转储同时压缩</span></span>
<span class="line"><span style="color:#EEFFFF;">missingok                如果日志丢失，不报错继续滚动下一个日志</span></span>
<span class="line"><span style="color:#EEFFFF;">errors address           专储时的错误信息发送到指定的Email 地址</span></span>
<span class="line"><span style="color:#EEFFFF;">ifempty                  即使日志文件为空文件也做轮转，这个是logrotate的缺省选项。</span></span>
<span class="line"><span style="color:#EEFFFF;">notifempty               当日志文件为空时，不进行轮转</span></span>
<span class="line"><span style="color:#EEFFFF;">mail address             把转储的日志文件发送到指定的E-mail 地址</span></span>
<span class="line"><span style="color:#EEFFFF;">nomail                   转储时不发送日志文件</span></span>
<span class="line"><span style="color:#EEFFFF;">olddir directory         转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统</span></span>
<span class="line"><span style="color:#EEFFFF;">noolddir                 转储后的日志文件和当前日志文件放在同一个目录下</span></span>
<span class="line"><span style="color:#EEFFFF;">sharedscripts            运行postrotate脚本，作用是在所有日志都轮转后统一执行一次脚本。如果没有配置这个，那么每个日志轮转后都会执行一次脚本</span></span>
<span class="line"><span style="color:#EEFFFF;">prerotate                在logrotate转储之前需要执行的指令，例如修改文件的属性等动作；必须独立成行</span></span>
<span class="line"><span style="color:#EEFFFF;">postrotate               在logrotate转储之后需要执行的指令，例如重新启动 (kill -HUP) 某个服务！必须独立成行</span></span>
<span class="line"><span style="color:#EEFFFF;">daily                    指定转储周期为每天</span></span>
<span class="line"><span style="color:#EEFFFF;">weekly                   指定转储周期为每周</span></span>
<span class="line"><span style="color:#EEFFFF;">monthly                  指定转储周期为每月</span></span>
<span class="line"><span style="color:#EEFFFF;">rotate count             指定日志文件删除之前转储的次数，0 指没有备份，5 指保留5 个备份</span></span>
<span class="line"><span style="color:#EEFFFF;">dateext                  使用当期日期作为命名格式</span></span>
<span class="line"><span style="color:#EEFFFF;">dateformat .%s           配合dateext使用，紧跟在下一行出现，定义文件切割后的文件名，必须配合dateext使用，只支持 %Y %m %d %s 这四个参数</span></span>
<span class="line"><span style="color:#EEFFFF;">size(或minsize) log-size 当日志文件到达指定的大小时才转储</span></span>
<span class="line"><span style="color:#EEFFFF;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-hidden="true">#</a></h3><p>在<code>/etc/logrotate.d</code>目录下创建任意后缀名的文件</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">/tmp/log/log*</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">copytruncate</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">daily</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">rotate</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">30</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">missingok</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">ifempty</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">compress</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#FFCB6B;">noolddir</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这种情况下，会将轮转过的log再重新轮转,因为轮转过后的文件名也是已log开头的</p>`,21),r=[p];function o(c,t,i,F,d,b){return a(),n("div",null,r)}const y=s(e,[["render",o]]);export{u as __pageData,y as default};
