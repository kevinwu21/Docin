import{_ as s,c as a,o as n,a as l}from"./app.82736834.js";const b=JSON.parse('{"title":"semanage","description":"","frontmatter":{},"headers":[{"level":2,"title":"补充说明","slug":"补充说明","link":"#补充说明","children":[{"level":3,"title":"语法","slug":"语法","link":"#语法","children":[]},{"level":3,"title":"选项","slug":"选项","link":"#选项","children":[]},{"level":3,"title":"实例","slug":"实例","link":"#实例","children":[]}]}],"relativePath":"linux/command/pages/semanage.md","lastUpdated":1666509709000}'),e={name:"linux/command/pages/semanage.md"},p=l(`<h1 id="semanage" tabindex="-1">semanage <a class="header-anchor" href="#semanage" aria-hidden="true">#</a></h1><p>默认目录的安全上下文查询与修改</p><h2 id="补充说明" tabindex="-1">补充说明 <a class="header-anchor" href="#补充说明" aria-hidden="true">#</a></h2><p><strong>semanage命令</strong> 是用来查询与修改SELinux默认目录的安全上下文。SELinux的策略与规则管理相关命令：seinfo命令、sesearch命令、getsebool命令、setsebool命令、semanage命令。</p><h3 id="语法" tabindex="-1">语法 <a class="header-anchor" href="#语法" aria-hidden="true">#</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">semanage</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">{login</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">user</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">port</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">interface</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">fcontext</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">translation</span><span style="color:#EEFFFF;">} -l</span></span>
<span class="line"><span style="color:#FFCB6B;">semanage</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">fcontext</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-{a</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">d</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">m</span><span style="color:#EEFFFF;">} </span><span style="color:#89DDFF;">[</span><span style="color:#EEFFFF;">-frst</span><span style="color:#89DDFF;">]</span><span style="color:#EEFFFF;"> file_spec</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="选项" tabindex="-1">选项 <a class="header-anchor" href="#选项" aria-hidden="true">#</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">-l：查询。</span></span>
<span class="line"><span style="color:#FFCB6B;">fcontext：主要用在安全上下文方面。</span></span>
<span class="line"><span style="color:#FFCB6B;">-a：增加，你可以增加一些目录的默认安全上下文类型设置。</span></span>
<span class="line"><span style="color:#FFCB6B;">-m：修改。</span></span>
<span class="line"><span style="color:#FFCB6B;">-d：删除。</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="实例" tabindex="-1">实例 <a class="header-anchor" href="#实例" aria-hidden="true">#</a></h3><p>查询一下<code>/var/www/html</code>的默认安全性本文的设置：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">semanage</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">fcontext</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-l</span></span>
<span class="line"><span style="color:#FFCB6B;">SELinux</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">fcontext</span><span style="color:#EEFFFF;">    </span><span style="color:#C3E88D;">type</span><span style="color:#EEFFFF;">          </span><span style="color:#C3E88D;">Context</span></span>
<span class="line"><span style="color:#82AAFF;">....</span><span style="color:#FFCB6B;">(前面省略</span><span style="color:#EEFFFF;">)....</span></span>
<span class="line"><span style="color:#FFCB6B;">/var/www(/</span><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">*</span><span style="color:#EEFFFF;">)</span><span style="color:#89DDFF;">?</span><span style="color:#EEFFFF;">      all files     system_u:object_r:httpd_sys_content_t:s0</span></span>
<span class="line"><span style="color:#82AAFF;">....</span><span style="color:#FFCB6B;">(後面省略</span><span style="color:#EEFFFF;">)....</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如上面例子所示，我们可以查询的到每个目录的安全性本文！而目录的设定可以使用正则表达式去指定一个范围。那么如果我们想要增加某些自定义目录的安全性本文呢？举例来说，我想要色设置<code>/srv/samba</code>成为 <code>public_content_t</code>的类型时，应该如何设置呢？</p><p>用semanage命令设置<code>/srv/samba</code>目录的默认安全性本文为<code>public_content_t</code>：</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/srv/samba</span></span>
<span class="line"><span style="color:#FFCB6B;">ll</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-Zd</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/srv/samba</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#EEFFFF;">  </span><span style="color:#C3E88D;">root</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">root</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">root:object_r:var_t</span><span style="color:#EEFFFF;">    </span><span style="color:#C3E88D;">/srv/samba</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如上所示，默认的情况应该是<code>var_t</code>这个咚咚的！</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">semanage</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">fcontext</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-l</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">|</span><span style="color:#EEFFFF;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/srv</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">/srv/</span><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">*</span><span style="color:#EEFFFF;">                     </span><span style="color:#C3E88D;">all</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">files</span><span style="color:#EEFFFF;">   </span><span style="color:#C3E88D;">system_u:object_r:var_t:s0</span></span>
<span class="line"><span style="color:#FFCB6B;">/srv/([^/</span><span style="color:#EEFFFF;">]</span><span style="color:#89DDFF;">*</span><span style="color:#EEFFFF;">/)</span><span style="color:#89DDFF;">?</span><span style="color:#EEFFFF;">ftp</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">/</span><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">*</span><span style="color:#89DDFF;">)?</span><span style="color:#EEFFFF;">     all files   system_u:object_r:public_content_t:s0</span></span>
<span class="line"><span style="color:#FFCB6B;">/srv/([^/</span><span style="color:#EEFFFF;">]</span><span style="color:#89DDFF;">*</span><span style="color:#EEFFFF;">/)</span><span style="color:#89DDFF;">?</span><span style="color:#EEFFFF;">www</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">/</span><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">*</span><span style="color:#89DDFF;">)?</span><span style="color:#EEFFFF;">     all files   system_u:object_r:httpd_sys_content_t:s0</span></span>
<span class="line"><span style="color:#FFCB6B;">/srv/([^/</span><span style="color:#EEFFFF;">]</span><span style="color:#89DDFF;">*</span><span style="color:#EEFFFF;">/)</span><span style="color:#89DDFF;">?</span><span style="color:#EEFFFF;">rsync</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">/</span><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">*</span><span style="color:#89DDFF;">)?</span><span style="color:#EEFFFF;">   all files   system_u:object_r:public_content_t:s0</span></span>
<span class="line"><span style="color:#FFCB6B;">/srv/gallery2(/</span><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">*</span><span style="color:#EEFFFF;">)</span><span style="color:#89DDFF;">?</span><span style="color:#EEFFFF;">         all files   system_u:object_r:httpd_sys_content_t:s0</span></span>
<span class="line"><span style="color:#FFCB6B;">/srv</span><span style="color:#EEFFFF;">                        </span><span style="color:#C3E88D;">directory</span><span style="color:#EEFFFF;">   </span><span style="color:#C3E88D;">system_u:object_r:var_t:s0</span><span style="color:#EEFFFF;">   </span><span style="color:#C3E88D;">//看这里！</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面则是默认的<code>/srv</code>底下的安全性本文资料，不过，并没有指定到<code>/srv/samba</code>。</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">semanage</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">fcontext</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">public_content_t</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/srv/samba(/.*)?</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">semanage</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">fcontext</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-l</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">|</span><span style="color:#EEFFFF;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/srv/samba</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">/srv/samba(/</span><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">*</span><span style="color:#EEFFFF;">)</span><span style="color:#89DDFF;">?</span><span style="color:#EEFFFF;">            all files   system_u:object_r:public_content_t:s0</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/etc/selinux/targeted/contexts/files/file_contexts.local</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># This file is auto-generated by libsemanage</span></span>
<span class="line"><span style="color:#545454;font-style:italic;"># Please use the semanage command to make changes</span></span>
<span class="line"><span style="color:#FFCB6B;">/srv/samba(/</span><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">*</span><span style="color:#EEFFFF;">)</span><span style="color:#89DDFF;">?</span><span style="color:#EEFFFF;">    system_u:object_r:public_content_t:s0  </span><span style="color:#545454;font-style:italic;">#写入这个档案</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">restorecon</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-Rv</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/srv/samba</span><span style="color:#EEFFFF;">*</span><span style="color:#EEFFFF;"> </span><span style="color:#545454;font-style:italic;">#尝试恢复默认值</span></span>
<span class="line"><span style="color:#FFCB6B;">ll</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-Zd</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/srv/samba</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#EEFFFF;">  </span><span style="color:#C3E88D;">root</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">root</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">system_u:object_r:public_content_t</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/srv/samba/</span><span style="color:#EEFFFF;">  </span><span style="color:#545454;font-style:italic;">#有默认值，以后用restorecon命令来修改比较简单！</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>semanage命令的功能很多，这里主要用到的仅有fcontext这个选项的用法而已。如上所示，你可以使用semanage来查询所有的目录默认值，也能够使用它来增加默认值的设置！</p>`,21),o=[p];function r(F,t,c,i,y,E){return n(),a("div",null,o)}const m=s(e,[["render",r]]);export{b as __pageData,m as default};
