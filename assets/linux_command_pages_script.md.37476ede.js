import{_ as s,c as n,o as a,a as l}from"./app.82736834.js";const D=JSON.parse('{"title":"script","description":"","frontmatter":{},"headers":[{"level":2,"title":"补充说明","slug":"补充说明","link":"#补充说明","children":[{"level":3,"title":"语法","slug":"语法","link":"#语法","children":[]},{"level":3,"title":"选项","slug":"选项","link":"#选项","children":[]},{"level":3,"title":"参数","slug":"参数","link":"#参数","children":[]},{"level":3,"title":"实例","slug":"实例","link":"#实例","children":[]}]}],"relativePath":"linux/command/pages/script.md","lastUpdated":1666509709000}'),p={name:"linux/command/pages/script.md"},o=l(`<h1 id="script" tabindex="-1">script <a class="header-anchor" href="#script" aria-hidden="true">#</a></h1><p>记录终端会话的所有操作</p><h2 id="补充说明" tabindex="-1">补充说明 <a class="header-anchor" href="#补充说明" aria-hidden="true">#</a></h2><p><strong>script</strong> 用于在终端会话中，记录用户的所有操作和命令的输出信息。简而言之，记录终端会话发生的一切信息，如同一台终端录像机。例如，用户在输入某条命令时，字符的键入和删除也都会被记录。用户在终端的所有操作、终端的回显等信息会被以 <code>raw</code> 格式存储在日志文件，称为终端数据文件。命令的时间信息会被单独以另一种结构储存为日志文件，称为时间日志文件。使用命令<code>exit</code>或者快捷键<code>Ctrl + D</code>停止记录。</p><h3 id="语法" tabindex="-1">语法 <a class="header-anchor" href="#语法" aria-hidden="true">#</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">script(选项</span><span style="color:#EEFFFF;">)</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">参数</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="选项" tabindex="-1">选项 <a class="header-anchor" href="#选项" aria-hidden="true">#</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">-a,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--append</span><span style="color:#EEFFFF;">              </span><span style="color:#545454;font-style:italic;"># 对终端会话的操作信息，以追加方式写入文件（保留原文件内容）</span></span>
<span class="line"><span style="color:#FFCB6B;">-c,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--command</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">command</span><span style="color:#EEFFFF;">     </span><span style="color:#545454;font-style:italic;"># 只运行 command 命令而不打开交互终端。相当于开启 script ，执行 command ，再退出 script</span></span>
<span class="line"><span style="color:#EEFFFF;">                          </span><span style="color:#545454;font-style:italic;"># command 可以是任意能够在终端会话执行的命令</span></span>
<span class="line"><span style="color:#FFCB6B;">-e,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--return</span><span style="color:#EEFFFF;">              </span><span style="color:#545454;font-style:italic;"># 返回子进程的退出状态码</span></span>
<span class="line"><span style="color:#FFCB6B;">-f,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--flush</span><span style="color:#EEFFFF;">               </span><span style="color:#545454;font-style:italic;"># 每次终端的内容发生变动，立马写入日志文件</span></span>
<span class="line"><span style="color:#FFCB6B;">--force</span><span style="color:#EEFFFF;">                   </span><span style="color:#545454;font-style:italic;"># 允许默认输出终端数据文件为符号链接</span></span>
<span class="line"><span style="color:#FFCB6B;">-o,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--output-limit</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">size</span><span style="color:#EEFFFF;">   </span><span style="color:#545454;font-style:italic;"># 限制终端数据文件和时间日志文件的大小，当文件大小达到此限制就会退出子进程</span></span>
<span class="line"><span style="color:#EEFFFF;">                          </span><span style="color:#545454;font-style:italic;"># size 的单位可以设置为：KiB(=1024)、KB(=1000)、MiB(1024*1024)、MB(=1000*1000)</span></span>
<span class="line"><span style="color:#EEFFFF;">                          </span><span style="color:#545454;font-style:italic;"># 同理还支持 GiB TiB PiB EiB ZiB YiB GB TB PB EB ZB YB</span></span>
<span class="line"><span style="color:#FFCB6B;">-q,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--quiet</span><span style="color:#EEFFFF;">               </span><span style="color:#545454;font-style:italic;"># 安静模式。启动和退出script命令不显示任何提示</span></span>
<span class="line"><span style="color:#FFCB6B;">-t[file</span><span style="color:#EEFFFF;">], --timing</span><span style="color:#89DDFF;">[=</span><span style="color:#EEFFFF;">file</span><span style="color:#89DDFF;">]</span><span style="color:#EEFFFF;"> </span><span style="color:#545454;font-style:italic;"># 输出时间日志信息到标准错误(stderr)或者文件</span></span>
<span class="line"><span style="color:#FFCB6B;">-V,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--version</span><span style="color:#EEFFFF;">             </span><span style="color:#545454;font-style:italic;"># 显示版本信息并退出</span></span>
<span class="line"><span style="color:#FFCB6B;">-h,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">--help</span><span style="color:#EEFFFF;">                </span><span style="color:#545454;font-style:italic;"># 显示帮助文本并退出</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="参数" tabindex="-1">参数 <a class="header-anchor" href="#参数" aria-hidden="true">#</a></h3><ul><li>终端数据文件：设置存储终端数据信息的文件名称</li></ul><h3 id="实例" tabindex="-1">实例 <a class="header-anchor" href="#实例" aria-hidden="true">#</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">script</span><span style="color:#EEFFFF;">                             </span><span style="color:#545454;font-style:italic;"># 开启记录，默认会在当前目录创建名称为 typescript 的文件来保存终端数据文件</span></span>
<span class="line"><span style="color:#FFCB6B;">script</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">command.log</span><span style="color:#EEFFFF;">                 </span><span style="color:#545454;font-style:italic;"># 开启记录，在当前目录创建名称为 command.log 的文件来保存终端数据文件</span></span>
<span class="line"><span style="color:#FFCB6B;">script</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">time.file</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">command.log</span><span style="color:#EEFFFF;">  </span><span style="color:#545454;font-style:italic;"># 开启记录，在当前目录创建名称为 command.log 的文件来保存终端数据文件</span></span>
<span class="line"><span style="color:#EEFFFF;">                                   </span><span style="color:#545454;font-style:italic;"># 在当前目录创建名称为 time.file 的文件来保存时间日志文件</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>以追加模式记录终端信息</strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">script</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">time.file</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">command.log</span></span>
<span class="line"><span style="color:#FFCB6B;">Script</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">started,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">file</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">is</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">command.log</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">echo</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello, world</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">hello,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">world</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">echo</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">date</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">+%Y-%m-%d %H:%M:%S</span><span style="color:#89DDFF;">&quot;)</span></span>
<span class="line"><span style="color:#F78C6C;">2020</span><span style="color:#EEFFFF;">-</span><span style="color:#F78C6C;">12</span><span style="color:#EEFFFF;">-</span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#EEFFFF;">:</span><span style="color:#F78C6C;">48</span><span style="color:#EEFFFF;">:</span><span style="color:#F78C6C;">46</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">echo</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Bye</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">Bye</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">ls</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-al</span></span>
<span class="line"><span style="color:#FFCB6B;">total</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">2</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">4096</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">48</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">37</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">4096</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">49</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">..</span></span>
<span class="line"><span style="color:#FFCB6B;">-rw-r--r--</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;">    </span><span style="color:#F78C6C;">0</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">19</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">03</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">a.txt</span></span>
<span class="line"><span style="color:#FFCB6B;">-rw-r--r--</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;">   </span><span style="color:#F78C6C;">12</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">19</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">04</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">b.txt</span></span>
<span class="line"><span style="color:#FFCB6B;">-rw-r--r--</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">2744</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">49</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">command.log</span></span>
<span class="line"><span style="color:#FFCB6B;">-rw-r--r--</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">790</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">49</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">time.file</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">exit</span></span>
<span class="line"><span style="color:#FFCB6B;">Script</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">done,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">file</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">is</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">command.log</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>然后，用户可以查看终端数据文件，使用方法如下</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">cat</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">command.log</span></span>
<span class="line"><span style="color:#FFCB6B;">Script</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">started</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">on</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">2020</span><span style="color:#C3E88D;">-</span><span style="color:#F78C6C;">12</span><span style="color:#C3E88D;">-</span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">48</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">25</span><span style="color:#C3E88D;">+</span><span style="color:#F78C6C;">08</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">00</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">[</span><span style="color:#EEFFFF;">TERM</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xterm-256color</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> TTY</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/dev/pts/0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> COLUMNS</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">75</span><span style="color:#89DDFF;">&quot;</span><span style="color:#EEFFFF;"> LINES</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">30</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">echo</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello, world</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">hello,</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">world</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">echo</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">date</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">+%Y-%m-%d %H:%M:%S</span><span style="color:#89DDFF;">&quot;)</span></span>
<span class="line"><span style="color:#F78C6C;">2020</span><span style="color:#EEFFFF;">-</span><span style="color:#F78C6C;">12</span><span style="color:#EEFFFF;">-</span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#EEFFFF;">:</span><span style="color:#F78C6C;">48</span><span style="color:#EEFFFF;">:</span><span style="color:#F78C6C;">46</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">echo</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Bye</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">Bye</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">ls</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-al</span></span>
<span class="line"><span style="color:#FFCB6B;">total</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">2</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">4096</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">48</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">37</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">4096</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">49</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">..</span></span>
<span class="line"><span style="color:#FFCB6B;">-rw-r--r--</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;">    </span><span style="color:#F78C6C;">0</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">19</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">03</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">a.txt</span></span>
<span class="line"><span style="color:#FFCB6B;">-rw-r--r--</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;">   </span><span style="color:#F78C6C;">12</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">19</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">04</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">b.txt</span></span>
<span class="line"><span style="color:#FFCB6B;">-rw-r--r--</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">2744</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">49</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">command.log</span></span>
<span class="line"><span style="color:#FFCB6B;">-rw-r--r--</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">1</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">zfb</span><span style="color:#EEFFFF;">  </span><span style="color:#F78C6C;">790</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">Dec</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">49</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">time.file</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">exit</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Script</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">done</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">on</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">2020</span><span style="color:#C3E88D;">-</span><span style="color:#F78C6C;">12</span><span style="color:#C3E88D;">-</span><span style="color:#F78C6C;">23</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">49</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">04</span><span style="color:#C3E88D;">+</span><span style="color:#F78C6C;">08</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">00</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">[</span><span style="color:#EEFFFF;">COMMAND_EXIT_CODE</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">zfb@localhost:~$</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>其中，只有命令<code>cat command.log</code>是用户输入，其他均为自动呈现。通过查看上面输出的时间<code>2020-12-23 20:48:46</code>，可以证明，这是重现的记录，而非重新执行一遍命令。也就是说，可以把<code>time.file</code>和<code>command.log</code>文件移动到任意一台机器上，都可以重现命令输入与终端回显。</p><p><strong>记录服务器用户会话操作</strong></p><p>以<code>root</code>身份编辑文件<code>/etc/profile</code>，在文件末尾追加以下内容</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">[</span><span style="color:#EEFFFF;"> $UID </span><span style="color:#89DDFF;">-ge</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">0</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#EEFFFF;">    </span><span style="color:#82AAFF;">exec</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/usr/bin/script</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#EEFFFF;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">/var/log/script-records/</span><span style="color:#EEFFFF;">$USER</span><span style="color:#C3E88D;">-</span><span style="color:#EEFFFF;">$UID</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">date</span><span style="color:#C3E88D;"> +%Y%m%d</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">.time</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-q</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/var/log/script-records/</span><span style="color:#EEFFFF;">$USER</span><span style="color:#C3E88D;">-</span><span style="color:#EEFFFF;">$UID</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">date</span><span style="color:#C3E88D;"> +%Y%m%d</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">.log</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后再以<code>root</code>身份创建文件夹用于存储服务器上的各个用户在终端的所有操作信息</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-darker" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">mkdir</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/var/log/script-records/</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">chmod</span><span style="color:#EEFFFF;"> </span><span style="color:#F78C6C;">733</span><span style="color:#EEFFFF;"> </span><span style="color:#C3E88D;">/var/log/script-records/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>最后，执行命令<code>source /etc/profile</code>即可。任意用户（<code>UID ≥ 0</code>）在终端执行的所有操作都会被安静地记录下来，以天为单位存储。</p>`,23),F=[o];function e(c,r,t,y,E,C){return a(),n("div",null,F)}const b=s(p,[["render",e]]);export{D as __pageData,b as default};
